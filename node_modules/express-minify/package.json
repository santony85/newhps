{
  "_from": "express-minify",
  "_id": "express-minify@1.0.0",
  "_inBundle": false,
  "_integrity": "sha512-04/iYxB79jGeNZBBkbAW7L7FMG4Wtu78F1SayXIKiJD6MfqYnOI3DD8no7QOntgedYCdYUpj+Skg8QWR/2WnMQ==",
  "_location": "/express-minify",
  "_phantomChildren": {},
  "_requested": {
    "escapedName": "express-minify",
    "fetchSpec": "latest",
    "name": "express-minify",
    "raw": "express-minify",
    "rawSpec": "",
    "registry": true,
    "saveSpec": null,
    "type": "tag"
  },
  "_requiredBy": [
    "#USER",
    "/"
  ],
  "_resolved": "https://registry.npmjs.org/express-minify/-/express-minify-1.0.0.tgz",
  "_shasum": "28c90ecb8add5f8da0d5d503739646fb54be5704",
  "_shrinkwrap": null,
  "_spec": "express-minify",
  "_where": "/var/newhps",
  "author": {
    "name": "Breezewish"
  },
  "bugs": {
    "url": "https://github.com/SummerWish/express-minify/issues"
  },
  "bundleDependencies": false,
  "dependencies": {
    "clean-css": "^4.1.7",
    "on-headers": "^1.0.1",
    "uglify-js": "^3.0.28"
  },
  "deprecated": false,
  "description": "Automatically minify and cache your javascript and css files.",
  "devDependencies": {
    "async": "^2.5.0",
    "coffee-script": "^1.12.7",
    "compression": "^1.7.0",
    "less": "^2.7.2",
    "mocha": "^3.5.0",
    "node-sass": "^4.5.3",
    "should": "^12.0.0",
    "stylus": "^0.54.5",
    "supertest": "^3.0.0"
  },
  "engines": {
    "node": ">= 4.0.0"
  },
  "homepage": "https://github.com/SummerWish/express-minify",
  "keywords": [
    "express",
    "minify",
    "uglify"
  ],
  "license": "MIT",
  "main": "index.js",
  "name": "express-minify",
  "optionalDependencies": {},
  "readme": "express-minify\n==============\n\nAutomatically minify (and cache) your JavaScript, CSS and JSON responses without pain.\nIt also supports LESS/SASS/Stylus/CoffeeScript compiling and minifying.\n\n[![Build Status](https://travis-ci.org/breeswish/express-minify.svg?branch=master)](https://travis-ci.org/breeswish/express-minify) [![npm version](https://img.shields.io/npm/v/express-minify.svg)](https://www.npmjs.com/package/express-minify) [![npm download counter](https://img.shields.io/npm/dm/express-minify.svg)](https://www.npmjs.com/package/express-minify)\n\n[![Dependency Status](https://david-dm.org/breeswish/express-minify.svg)](https://david-dm.org/breeswish/express-minify) [![devDependency Status](https://david-dm.org/breeswish/express-minify/dev-status.svg)](https://david-dm.org/breeswish/express-minify#info=devDependencies)\n\n[![NodeICO](https://nodei.co/npm/express-minify.png?downloads=true&downloadRank=true&stars=true)](https://www.npmjs.com/package/express-minify)\n\n# Installation\n\n```\nnpm install express-minify\n```\n\n# Basic Usage\n\nexpress-minify takes care of all responses. You don't even need to pass a source directory as other minifying middlewares.\n\n```javascript\nvar minify = require('express-minify');\napp.use(minify());\n```\n\nIt's very easy and elegant to integrate express-minify with [express.static](http://expressjs.com/en/api.html#express.static) and [compression](https://github.com/expressjs/compression):\n\n```javascript\napp.use(compression());\napp.use(minify());\napp.use(express.static(__dirname + '/static'));\n```\n\nNote that the order of the middlewares is important. In the example above, we want to: serve static files → for JS & CSS: minify → GZip → send to user, so we have such orders.\n\n## Options\n\nDefault:\n\n```javascript\napp.use(minify({\n  cache: false,\n  uglifyJsModule: null,\n  errorHandler: null,\n  jsMatch: /javascript/,\n  cssMatch: /css/,\n  jsonMatch: /json/,\n  sassMatch: /scss/,\n  lessMatch: /less/,\n  stylusMatch: /stylus/,\n  coffeeScriptMatch: /coffeescript/,\n}));\n```\n\n- `cache`: `String | false`\n\n  The directory for cache storage (must be writeable). Pass `false` to cache in the memory (not recommended). If you want to disable cache for specific response, see [Disable Minifying or Caching for Specific Response](#disable-minifying-or-caching-for-specific-response).\n\n- `uglifyJsModule`: `Object`\n\n  Customize [UglifyJS](https://github.com/mishoo/UglifyJS2) (>= 3) module. If not specified, it will be `require('uglify-js')`. Example: [Use Uglify-ES](#use-uglify-es).\n\n- `errorHandler`: `Function(errorInfo, callback)`\n\n  Function to handle compiling and minifying errors. You can determine what to respond for specific kind of error. See [Customize Error Behavior](#customize-error-behavior).\n\n- `jsMatch`: `RegExp | false`\n\n  Matches JavaScript content-type. Pass `false` to disable handling this kind of content.\n\n- `cssMatch`: `RegExp | false`\n\n  Matches CSS content-type. Pass `false` to disable handling this kind of content.\n\n- `jsonMatch`: `RegExp | false`\n\n  Matches JSON content-type. Pass `false` to disable handling this kind of content.\n\n- `sassMatch`: `RegExp | false`\n\n  Matches SASS content-type. Pass `false` to disable handling this kind of content.\n\n- `lessMatch`: `RegExp | false`\n\n  Matches LESS content-type. Pass `false` to disable handling this kind of content.\n\n- `stylusMatch`: `RegExp | false`\n\n  Matches Stylus content-type. Pass `false` to disable handling this kind of content.\n\n- `coffeeScriptMatch`: `RegExp | false`\n\n  Matches CoffeeScript content-type. Pass `false` to disable handling this kind of content.\n\n## Per-response Options\n\nOptions below can be supplied for specific response:\n\n- `response.minifyOptions.enabled`: `boolean`\n\n  Pass `false` to disable all kind of processing for this response: no compiling, no minifying.\n\n- `response.minifyOptions.minify`: `boolean`\n\n  Pass `false` to disable minifying (JS, CSS and JSON) for this response, suitable for already-minified contents: [example](#disable-minifying-or-caching-for-a-response).\n\n- `response.minifyOptions.cache`: `boolean`\n\n  Pass `false` to disable caching the processed response data, suitable for dynamic contents: [example](#disable-minifying-or-caching-for-a-response).\n\n- `response.minifyOptions.js`: `Object`\n\n  Set [UglifyJS options](https://github.com/mishoo/UglifyJS2#minify-options). You may want to disable mangling or compressing for specific response (e.g. AngularJS) via this option: [example](#specify-uglifyjs-options).\n\n- `response.minifyOptions.css`: `Object`\n\n  Set [clean-css constructor options](https://github.com/jakubpawlowicz/clean-css#constructor-options).\n\n- `response.minifyOptions.sass`: `Object`\n\n  Set [node-sass render options](https://github.com/sass/node-sass#options).\n\n- `response.minifyOptions.less`: `Object`\n\n  Set [less render options](http://lesscss.org/#using-less-configuration).\n\n# Examples\n\n## Enable File Cache\n\nBy default, express-minify uses memory cache. You can change to file cache:\n\n```javascript\napp.use(minify({cache: __dirname + '/cache'}));\n```\n\n## Compile and Minify CoffeeScript/LESS/SASS/Stylus\n\nexpress-minify can automatically compile your files and minify it without the need of specifying a source file directory. Currently it supports CoffeeScript, SASS, LESS and Stylus.\n\nTo enable this feature, first of all you need to install those modules by yourself:\n\n```bash\n# You needn't install all of these. Only choose what you need.\nnpm install coffee-script less node-sass stylus --save\n```\n\nThen you need to define MIME for those files:\n\n```javascript\n// visit http://localhost/test.coffee\n\nexpress.static.mime.define(\n{\n  'text/coffeescript':  ['coffee'],\n  'text/less':          ['less'],\n  'text/x-scss':        ['scss'],\n  'text/stylus':        ['styl']\n});\n\napp.use(minify());\n```\n\n## Customize Error Behavior\n\nErrors may thrown at the compiling stage (for CoffeeScript/LESS/SASS/Stylus) or at the minifying stage (for JSON/UglifyJS/CleanCSS). The default behavior is returning the error message for compiling errors and returning original content for minifying errors.\n\nYou can customize this behavior or get notified about the error by providing `errorHandler` in options:\n\n```javascript\nvar minify = require('express-minify');\n\nvar myErrorHandler = function (errorInfo, callback) {\n  console.log(errorInfo);\n  // below is the default implementation (minify.Minifier.defaultErrorHandler)\n  if (errorInfo.stage === 'compile') {\n    callback(errorInfo.error, JSON.stringify(errorInfo.error));\n    return;\n  }\n  callback(errorInfo.error, errorInfo.body);\n};\n\napp.use(minify({ errorHandler: myErrorHandler }));\n```\n\nThe structure of `errorInfo` is:\n\n- `stage`: One of `[\"compile\", \"minify\"]`\n\n  The stage when error is thrown.\n\n- `body`: `String`\n\n  The content to compile or minify, which causes the error of course.\n  If there are errors when minifying the compiled source, `body` will be the compiled source.\n\n- `assetType`: One of `[\"js\", \"css\", \"json\", \"coffee\", \"sass\", \"less\", \"stylus\"]`\n\n  The type of the original content.\n\n- `options`: `Object`\n\n  The options you supplied via `response.minifyOptions`.\n\n- `error`: `Error`\n\n  The error thrown by the corresponding processor.\n\n## Use Uglify-ES\n\nYou can pass the [uglify-es](https://www.npmjs.com/package/uglify-es) module in options to replace the built-in UglifyJS 3 module.\n\n```javascript\nvar uglifyEs = require('uglify-es');\napp.use(minify({\n  uglifyJsModule: uglifyEs,\n}));\n```\n\nRemember to invalidate file caches after switching a UglifyJS module. They won't be invalidated automatically.\n\n## Specify UglifyJS Options\n\n### Example 1: Disable Mangling for AngularJS Source Files\n\n```javascript\napp.use(function(req, res, next)\n{\n  // do not mangle -angular.js files\n  if (/-angular\\.js$/.test(req.url)) {\n    res.minifyOptions = res.minifyOptions || {};\n    res.minifyOptions.js = { mangle: true };\n  }\n  next();\n});\napp.use(minify());\n```\n\n### Example 2: Preserve Comments for Specific JavaScript Files\n\n```javascript\napp.use(function(req, res, next)\n{\n  if (/\\.(user|meta)\\.js$/.test(req.url)) {\n    res.minifyOptions = res.minifyOptions || {};\n    res.minifyOptions.js = { output: { comments: true } };\n  }\n  next();\n});\n```\n\n## Dynamic Response\n\nexpress-minify is able to handle all kind of responses, including dynamic responses.\n\n```javascript\nvar responseJS =\n  \"(function(window, undefined)\\n\" +\n  \"{\\n\" +\n  \"\\n\" +\n  \"    var hello = 'hello';\\n\" +\n  \"\\n\" +\n  \"    var world = 'world';\\n\" +\n  \"\\n\" +\n  \"    alert(hello + world);\\n\" +\n  \"\\n\" +\n  \"})(window);\"\napp.use(minify());\napp.get('/response.js', function(req, res)\n{\n  res.setHeader('Content-Type', 'application/javascript');\n  res.end(responseJS);\n});\n```\n\n## Disable Minifying or Caching for Specific Response\n\nIf you don't want to minify a specific response, just set `response.minifyOptions.minify = false`.\n\nIf you want to minify a response but don't want to cache it (for example, dynamic response data), set `response.minifyOptions.cache = false`.\n\n### Example 1. Disable Minification for Minified Assets\n\n```javascript\napp.use(function(req, res, next)\n{\n  if (/\\.min\\.(css|js)$/.test(req.url)) {\n    res.minifyOptions = res.minifyOptions || {};\n    res.minifyOptions.minify = false;\n  }\n  next();\n});\napp.use(minify());\n```\n\n### Example 2. Disable Caching for Dynamic Content\n\n```javascript\napp.use(minify());\napp.get('/server_time_min.jsonp', function(req, res)\n{\n  var obj = {\n    'ok': true,\n    'data': {\n      'timestamp': new Date().getTime(),\n    },\n  };\n\n  // minify this response, but do not cache it\n  res.minifyOptions = res.minifyOptions || {};\n  res.minifyOptions.cache = false;\n  res.setHeader('Content-Type', 'application/javascript');\n  res.send(\"callback(\" + JSON.stringify(obj, null, 4) + \");\");\n});\n\napp.get('/server_time.jsonp', function(req, res)\n{\n  var obj = {\n    'ok': true,\n    'data': {\n      'timestamp': new Date().getTime(),\n    },\n  };\n\n  // do not minify (and do not cache) this response\n  res.minifyOptions = res.minifyOptions || {};\n  res.minifyOptions.minify = false;\n  res.setHeader('Content-Type', 'application/javascript');\n  res.send(\"callback(\" + JSON.stringify(obj, null, 4) + \");\");\n});\n```\n\n# Change Log\n\n1.0.0\n\n- Replace cssmin with [clean-css](https://github.com/jakubpawlowicz/clean-css)\n- Upgrade to use Uglify-JS 3 API\n- Support options for CSS minifying\n- Support options for SASS and LESS compiling\n- Refine naming conversion\n- Minimum required NodeJs version changed to `4.0.0` for `Object.assign`\n\n0.2.0\n\n- Support `onerror`\n- Minimum required NodeJs version changed to `0.12.0` for `fs.access`\n\n0.1.7\n\n- Support customizing UglifyJS/cssmin instance\n\n0.1.6\n\n- Make `node-sass`, `stylus`, `less`, `coffee-script` dependency optional, now developers need to manually install those modules to enable compiling\n\n0.1.5\n\n- Fix MIME for Js\n- Fix JSON minify performance issue\n\n0.1.4\n\n- Add some useful badges [#27](https://github.com/SummerWish/express-minify/pull/27)\n- Update dependencies\n- Support JSON minify [#25](https://github.com/SummerWish/express-minify/pull/25)\n- Start to use travis-ci online build testing\n\n0.1.3\n\n- Update dependencies [#19](https://github.com/breeswish/express-minify/issues/19) [#20](https://github.com/breeswish/express-minify/issues/20)\n\n0.1.2\n\n- Added `res._skip`.\n- Modified behaviour of `res._no_minify`. Now it will only disable minifying and won't cause precompiling not working. [#17](https://github.com/breeswish/express-minify/issues/17)\n- Fixed cache bugs with response options.\n\n0.1.1\n\n- Added fallback for `res._no_mangle = true` (Please use `res._uglifyMangle = false`)\n- Update dependencies\n\n0.1.0\n\n- Changed disabling mangle: `res._no_mangle = true` => `res._uglifyMangle = false`\n- Added support for passing additional UglifyJs options: `res._uglifyCompress`, `res._uglifyOutput` [#15](https://github.com/breeswish/express-minify/issues/15)\n\n0.0.11\n\n- Update dependencies [#11](https://github.com/breeswish/express-minify/issues/11)\n\n0.0.10\n\n- Added tests\n\n- Fixed SASS compiling\n\n- Fixed express-compression compatibility\n\n0.0.9\n\n- Added support for `res._no_mangle` [#10](https://github.com/breeswish/express-minify/pull/10)\n\n0.0.8\n\n- Removed options of `whitelist` and `blacklist`\n\n- Added support for `res._no_cache` [#5](https://github.com/breeswish/express-minify/issues/5)\n\n- Node v0.10 compatible\n\n0.0.7\n\n- Changed `options`'s default `blacklist` to `[/\\.min\\.(css|js)$/]`\n\n- Replaced `uglifycss` with `cssmin`\n\n- Dropped support for `.sass` (https://github.com/andrew/node-sass/issues/12)\n\n- Fixed [#3](https://github.com/breeswish/express-minify/issues/3)\n\n0.0.6\n\n- Support for blacklist and whitelist [#2](https://github.com/breeswish/express-minify/issues/2)\n\n0.0.5\n\n- Added support for `res._no_minify`\n\n- Fixed [#1](https://github.com/breeswish/express-minify/issues/1)\n\n0.0.4\n\n- Support for LESS/SASS/Stylus/CoffeeScript parsing and minifying\n\n0.0.3\n\n- Support for file cache\n\n- Fixed the bug of non-string path\n\n0.0.2\n\n- Support for dynamic minifying\n\n# License\n\nThe MIT License (MIT)\n\nCopyright (c) 2017 Breezewish\n\nPermission is hereby granted, free of charge, to any person obtaining a copy of\nthis software and associated documentation files (the \"Software\"), to deal in\nthe Software without restriction, including without limitation the rights to\nuse, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of\nthe Software, and to permit persons to whom the Software is furnished to do so,\nsubject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS\nFOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR\nCOPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER\nIN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN\nCONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n",
  "readmeFilename": "README.md",
  "repository": {
    "type": "git",
    "url": "git://github.com/SummerWish/express-minify.git"
  },
  "scripts": {
    "test": "mocha --check-leaks --reporter dot"
  },
  "version": "1.0.0"
}
